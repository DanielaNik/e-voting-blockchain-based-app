{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\src\\\\components\\\\LoginPage.js\";\nimport React, { Component } from 'react';\nimport { withRouter } from 'react-router';\nimport { useHistory } from 'react-router-dom';\nimport { useVotingContext } from './VotingContext';\nimport Web3 from 'web3';\n\nvar LoginPage = /*#__PURE__*/function (_Component) {\n  _inherits(LoginPage, _Component);\n\n  function LoginPage(props) {\n    var _this;\n\n    _classCallCheck(this, LoginPage);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(LoginPage).call(this, props));\n\n    _this.handleInputChange = function (event) {\n      var _event$target = event.target,\n          name = _event$target.name,\n          value = _event$target.value;\n\n      _this.setState(_defineProperty({}, name, value));\n    };\n\n    _this.handleSubmit = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n        var history, _this$state, voterId, password, voting, voterEligible, voterInfo, web3, hashedPassword, userHasVoted;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                event.preventDefault();\n                history = _this.props.history;\n                _this$state = _this.state, voterId = _this$state.voterId, password = _this$state.password;\n                voting = useVotingContext();\n                _context.prev = 4;\n                _context.next = 7;\n                return voting.methods.isVoterEligible(voterId).call();\n\n              case 7:\n                voterEligible = _context.sent;\n\n                if (!voterEligible) {\n                  _context.next = 23;\n                  break;\n                }\n\n                _context.next = 11;\n                return voting.methods.getVoterDetails(voterId).call();\n\n              case 11:\n                voterInfo = _context.sent;\n                web3 = new Web3();\n                hashedPassword = web3.utils.sha3(password);\n\n                if (!(voterInfo.passwordHash !== hashedPassword)) {\n                  _context.next = 17;\n                  break;\n                }\n\n                _this.setState({\n                  error: 'Invalid password.'\n                });\n\n                return _context.abrupt(\"return\");\n\n              case 17:\n                _context.next = 19;\n                return voting.methods.hasVoted(voterId).call();\n\n              case 19:\n                userHasVoted = _context.sent;\n\n                if (userHasVoted) {\n                  _this.setState({\n                    error: 'You have already voted.'\n                  });\n                } else {\n                  _this.setState({\n                    loggedIn: true\n                  });\n\n                  localStorage.setItem('loggedIn', true);\n                  localStorage.setItem('voterId', voterId);\n                  history.push('/voting?voterId=' + voterId);\n                }\n\n                _context.next = 24;\n                break;\n\n              case 23:\n                _this.setState({\n                  error: 'You are not eligible to vote.'\n                });\n\n              case 24:\n                _context.next = 30;\n                break;\n\n              case 26:\n                _context.prev = 26;\n                _context.t0 = _context[\"catch\"](4);\n                console.error(_context.t0);\n\n                _this.setState({\n                  error: 'An error occurred. Please try again.'\n                });\n\n              case 30:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[4, 26]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.handleLogout = function () {\n      _this.setState({\n        voterId: '',\n        password: '',\n        error: '',\n        loggedIn: false\n      });\n    };\n\n    _this.state = {\n      voterId: '',\n      password: '',\n      error: '',\n      loggedIn: false\n    };\n    return _this;\n  }\n\n  _createClass(LoginPage, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var loggedIn = localStorage.getItem('loggedIn') === 'true';\n      var voterId = localStorage.getItem('voterId');\n\n      if (loggedIn && voterId !== null) {\n        this.setState({\n          loggedIn: loggedIn\n        });\n        this.setState({\n          voterId: voterId\n        });\n      }\n\n      console.log('voterid', voterId);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state2 = this.state,\n          voterId = _this$state2.voterId,\n          password = _this$state2.password,\n          error = _this$state2.error;\n\n      if (this.state.loggedIn) {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 85,\n            columnNumber: 9\n          }\n        }, /*#__PURE__*/React.createElement(\"p\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 11\n          }\n        }, \"You are logged in as voter \", voterId), /*#__PURE__*/React.createElement(\"button\", {\n          onClick: this.handleLogout,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 11\n          }\n        }, \"Logout\"));\n      }\n\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"h2\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 9\n        }\n      }, \"Login Page\"), /*#__PURE__*/React.createElement(\"form\", {\n        onSubmit: this.handleSubmit,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 13\n        }\n      }, \"Voter ID:\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        name: \"voterId\",\n        value: voterId,\n        onChange: this.handleInputChange,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 13\n        }\n      }, \"Password:\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"password\",\n        name: \"password\",\n        value: password,\n        onChange: this.handleInputChange,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"submit\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 13\n        }\n      }, \"Login\")), error && /*#__PURE__*/React.createElement(\"p\", {\n        className: \"error\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 21\n        }\n      }, error)));\n    }\n  }]);\n\n  return LoginPage;\n}(Component);\n\nexport default withRouter(LoginPage);","map":{"version":3,"sources":["C:/Users/danie/truffleProjects/ElectionSystem/src/components/LoginPage.js"],"names":["React","Component","withRouter","useHistory","useVotingContext","Web3","LoginPage","props","handleInputChange","event","target","name","value","setState","handleSubmit","preventDefault","history","state","voterId","password","voting","methods","isVoterEligible","call","voterEligible","getVoterDetails","voterInfo","web3","hashedPassword","utils","sha3","passwordHash","error","hasVoted","userHasVoted","loggedIn","localStorage","setItem","push","console","handleLogout","getItem","log"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { withRouter } from 'react-router';\r\nimport { useHistory } from 'react-router-dom';\r\nimport { useVotingContext } from './VotingContext' \r\nimport Web3 from 'web3';\r\n\r\nclass LoginPage extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      voterId: '',\r\n      password: '',\r\n      error: '',\r\n      loggedIn: false\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    const loggedIn = localStorage.getItem('loggedIn') === 'true';\r\n    const voterId = localStorage.getItem('voterId');\r\n    if (loggedIn && voterId!==null) {\r\n      this.setState({ loggedIn });\r\n      this.setState({ voterId });\r\n    }\r\n    console.log('voterid',voterId)\r\n  }\r\n  \r\n  handleInputChange = event => {\r\n    const { name, value } = event.target;\r\n    this.setState({ [name]: value });\r\n  };\r\n\r\n  handleSubmit = async event => {\r\n    event.preventDefault();\r\n    const { history } = this.props;\r\n    const { voterId, password } = this.state;\r\n    const voting = useVotingContext();\r\n\r\n    try {\r\n      const voterEligible = await voting.methods.isVoterEligible(voterId).call();\r\n      if (voterEligible) {\r\n        const voterInfo = await voting.methods.getVoterDetails(voterId).call();\r\n        const web3 = new Web3()\r\n        const hashedPassword = web3.utils.sha3(password);\r\n        \r\n        if (voterInfo.passwordHash !== hashedPassword) {\r\n          this.setState({ error: 'Invalid password.' });\r\n          return;\r\n        }\r\n\r\n        const userHasVoted = await voting.methods.hasVoted(voterId).call();\r\n\r\n        if (userHasVoted) {\r\n          this.setState({ error: 'You have already voted.' });\r\n        } else {\r\n          this.setState({loggedIn: true})\r\n          localStorage.setItem('loggedIn', true);\r\n          localStorage.setItem('voterId', voterId);\r\n          history.push('/voting?voterId='+voterId);\r\n        }\r\n      } else {\r\n        this.setState({ error: 'You are not eligible to vote.' });\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n      this.setState({ error: 'An error occurred. Please try again.' });\r\n    }\r\n  };\r\n\r\n  handleLogout = () => {\r\n    this.setState({\r\n      voterId: '',\r\n      password: '',\r\n      error: '',\r\n      loggedIn: false,\r\n    });\r\n  };\r\n  \r\n\r\n  render() {\r\n    const { voterId, password, error } = this.state;\r\n\r\n    if (this.state.loggedIn) {\r\n      return (\r\n        <div>\r\n          <p>You are logged in as voter {voterId}</p>\r\n          <button onClick={this.handleLogout}>Logout</button>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div>\r\n        <h2>Login Page</h2>\r\n        <form onSubmit={this.handleSubmit}>\r\n          <div>\r\n            <label>Voter ID:</label>\r\n            <input\r\n              type=\"text\"\r\n              name=\"voterId\"\r\n              value={voterId}\r\n              onChange={this.handleInputChange}\r\n            />\r\n          </div>\r\n          <div>\r\n            <label>Password:</label>\r\n            <input\r\n              type=\"password\"\r\n              name=\"password\"\r\n              value={password}\r\n              onChange={this.handleInputChange}\r\n            />\r\n          </div>\r\n          <div>\r\n            <button type=\"submit\">Login</button>\r\n          </div>\r\n          {error && <p className=\"error\">{error}</p>}\r\n        </form>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(LoginPage);\r\n"]},"metadata":{},"sourceType":"module"}