{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\src\\\\components\\\\LoginPage.js\";\nimport React, { useState, useContext } from 'react';\nimport { withRouter } from 'react-router';\nimport { VotingContext, fetchUserVotingStatus } from './VotingContext';\nimport Web3 from 'web3';\n\nfunction LoginPage(props) {\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      voterId = _useState2[0],\n      setVoterId = _useState2[1];\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      password = _useState4[0],\n      setPassword = _useState4[1];\n\n  var _useState5 = useState(''),\n      _useState6 = _slicedToArray(_useState5, 2),\n      error = _useState6[0],\n      setError = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      loggedIn = _useState8[0],\n      setLoggedIn = _useState8[1];\n\n  var history = props.history,\n      account = props.account,\n      voting = props.voting;\n\n  var _useContext = useContext(VotingContext),\n      userHasVoted = _useContext.userHasVoted;\n\n  var handleInputChange = function handleInputChange(event) {\n    var _event$target = event.target,\n        name = _event$target.name,\n        value = _event$target.value;\n\n    if (name === 'voterId') {\n      setVoterId(value);\n    } else if (name === 'password') {\n      setPassword(value);\n    }\n  };\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n      var voterEligible, voterInfo, web3, hashedPassword;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              event.preventDefault();\n              _context.prev = 1;\n              _context.next = 4;\n              return voting.methods.isVoterEligible(voterId, account).call();\n\n            case 4:\n              voterEligible = _context.sent;\n\n              if (!voterEligible) {\n                _context.next = 17;\n                break;\n              }\n\n              _context.next = 8;\n              return voting.methods.getVoterDetails(voterId).call();\n\n            case 8:\n              voterInfo = _context.sent;\n              web3 = new Web3();\n              hashedPassword = web3.utils.sha3(password);\n\n              if (!(voterInfo.passwordHash !== hashedPassword)) {\n                _context.next = 14;\n                break;\n              }\n\n              setError('Invalid password.');\n              return _context.abrupt(\"return\");\n\n            case 14:\n              if (userHasVoted) {\n                setError('You have already voted.');\n              } else {\n                setLoggedIn(true);\n                localStorage.setItem('loggedIn', true);\n                localStorage.setItem('voterId', voterId);\n                history.push('/voting?voterId=' + voterId);\n              }\n\n              _context.next = 18;\n              break;\n\n            case 17:\n              setError('You are not eligible to vote.');\n\n            case 18:\n              _context.next = 24;\n              break;\n\n            case 20:\n              _context.prev = 20;\n              _context.t0 = _context[\"catch\"](1);\n              console.error(_context.t0);\n              setError('An error occurred. Please try again.');\n\n            case 24:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 20]]);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleLogout = function handleLogout() {\n    setVoterId('');\n    setPassword('');\n    setError('');\n    setLoggedIn(false);\n    localStorage.setItem('loggedIn', false);\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 5\n    }\n  }, loggedIn ? /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 11\n    }\n  }, \"You are logged in as voter \", voterId), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: handleLogout,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 11\n    }\n  }, \"Logout\")) : /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 11\n    }\n  }, \"Login Page\"), /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 15\n    }\n  }, \"Voter ID:\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    name: \"voterId\",\n    value: voterId,\n    onChange: handleInputChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 15\n    }\n  }, \"Password:\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"password\",\n    name: \"password\",\n    value: password,\n    onChange: handleInputChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 15\n    }\n  }, \"Login\")), error && /*#__PURE__*/React.createElement(\"p\", {\n    className: \"error\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 23\n    }\n  }, error))));\n}\n\nexport default withRouter(LoginPage);","map":{"version":3,"sources":["C:/Users/danie/truffleProjects/ElectionSystem/src/components/LoginPage.js"],"names":["React","useState","useContext","withRouter","VotingContext","fetchUserVotingStatus","Web3","LoginPage","props","voterId","setVoterId","password","setPassword","error","setError","loggedIn","setLoggedIn","history","account","voting","userHasVoted","handleInputChange","event","target","name","value","handleSubmit","preventDefault","methods","isVoterEligible","call","voterEligible","getVoterDetails","voterInfo","web3","hashedPassword","utils","sha3","passwordHash","localStorage","setItem","push","console","handleLogout"],"mappings":"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","sourcesContent":["import React, { useState, useContext } from 'react';\r\nimport { withRouter } from 'react-router';\r\nimport { VotingContext, fetchUserVotingStatus } from './VotingContext';\r\nimport Web3 from 'web3';\r\n\r\nfunction LoginPage(props) {\r\n  const [voterId, setVoterId] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [error, setError] = useState('');\r\n  const [loggedIn, setLoggedIn] = useState(false);\r\n\r\n  const { history, account, voting } = props;\r\n  const { userHasVoted } = useContext(VotingContext);\r\n\r\n  const handleInputChange = event => {\r\n    const { name, value } = event.target;\r\n    if (name === 'voterId') {\r\n      setVoterId(value);\r\n    } else if (name === 'password') {\r\n      setPassword(value);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async event => {\r\n    event.preventDefault();\r\n\r\n    try {\r\n      const voterEligible = await voting.methods.isVoterEligible(voterId, account).call();\r\n      if (voterEligible) {\r\n        const voterInfo = await voting.methods.getVoterDetails(voterId).call();\r\n        const web3 = new Web3();\r\n        const hashedPassword = web3.utils.sha3(password);\r\n\r\n        if (voterInfo.passwordHash !== hashedPassword) {\r\n          setError('Invalid password.');\r\n          return;\r\n        }\r\n\r\n        if (userHasVoted) {\r\n          setError('You have already voted.');\r\n        } else {\r\n          setLoggedIn(true);\r\n          localStorage.setItem('loggedIn', true);\r\n          localStorage.setItem('voterId', voterId);\r\n          history.push('/voting?voterId=' + voterId);\r\n        }\r\n      } else {\r\n        setError('You are not eligible to vote.');\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n      setError('An error occurred. Please try again.');\r\n    }\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    setVoterId('');\r\n    setPassword('');\r\n    setError('');\r\n    setLoggedIn(false);\r\n\r\n    localStorage.setItem('loggedIn', false);\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      {loggedIn ? (\r\n        <div>\r\n          <p>You are logged in as voter {voterId}</p>\r\n          <button onClick={handleLogout}>Logout</button>\r\n        </div>\r\n      ) : (\r\n        <div>\r\n          <h2>Login Page</h2>\r\n          <form onSubmit={handleSubmit}>\r\n            <div>\r\n              <label>Voter ID:</label>\r\n              <input\r\n                type=\"text\"\r\n                name=\"voterId\"\r\n                value={voterId}\r\n                onChange={handleInputChange}\r\n              />\r\n            </div>\r\n            <div>\r\n              <label>Password:</label>\r\n              <input\r\n                type=\"password\"\r\n                name=\"password\"\r\n                value={password}\r\n                onChange={handleInputChange}\r\n              />\r\n            </div>\r\n            <div>\r\n              <button type=\"submit\">Login</button>\r\n            </div>\r\n            {error && <p className=\"error\">{error}</p>}\r\n          </form>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default withRouter(LoginPage);\r\n"]},"metadata":{},"sourceType":"module"}