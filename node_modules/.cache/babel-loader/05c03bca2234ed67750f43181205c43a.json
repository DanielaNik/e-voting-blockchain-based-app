{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"C:\\\\Users\\\\danie\\\\truffleProjects\\\\ElectionSystem\\\\src\\\\components\\\\LoginPage.js\";\nimport React, { Component } from 'react';\nimport { withRouter } from 'react-router';\nimport Web3 from 'web3';\n\nvar LoginPage = /*#__PURE__*/function (_Component) {\n  _inherits(LoginPage, _Component);\n\n  function LoginPage(props) {\n    var _this;\n\n    _classCallCheck(this, LoginPage);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(LoginPage).call(this, props));\n\n    _this.handleInputChange = function (event) {\n      var _event$target = event.target,\n          name = _event$target.name,\n          value = _event$target.value;\n\n      _this.setState(_defineProperty({}, name, value));\n    };\n\n    _this.handleSubmit = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n        var _this$props, voting, history, _this$state, voterId, password, voterEligible, voterInfo, web3, hashedPassword, userHasVoted;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                event.preventDefault();\n                _this$props = _this.props, voting = _this$props.voting, history = _this$props.history;\n                _this$state = _this.state, voterId = _this$state.voterId, password = _this$state.password;\n                _context.prev = 3;\n                _context.next = 6;\n                return voting.methods.isVoterEligible(voterId).call();\n\n              case 6:\n                voterEligible = _context.sent;\n\n                if (!voterEligible) {\n                  _context.next = 24;\n                  break;\n                }\n\n                _context.next = 10;\n                return voting.methods.getVoterDetails(voterId).call();\n\n              case 10:\n                voterInfo = _context.sent;\n                web3 = new Web3();\n                hashedPassword = web3.utils.sha3(password);\n\n                if (!(voterInfo.passwordHash !== hashedPassword)) {\n                  _context.next = 18;\n                  break;\n                }\n\n                console.log('FROM CONTRACT:', voterInfo.passwordHash);\n                console.log('FROM sha3', hashedPassword);\n\n                _this.setState({\n                  error: 'Invalid password.'\n                });\n\n                return _context.abrupt(\"return\");\n\n              case 18:\n                _context.next = 20;\n                return voting.methods.hasVoted(voterId).call();\n\n              case 20:\n                userHasVoted = _context.sent;\n\n                if (userHasVoted) {\n                  _this.setState({\n                    error: 'You have already voted.'\n                  });\n                } else {\n                  _this.setState({\n                    loggedIn: true\n                  });\n\n                  localStorage.setItem('loggedIn', true);\n                  localStorage.setItem('voterId', voterId);\n                  history.push('/voting?voterId=' + voterId);\n                }\n\n                _context.next = 25;\n                break;\n\n              case 24:\n                _this.setState({\n                  error: 'You are not eligible to vote.'\n                });\n\n              case 25:\n                _context.next = 31;\n                break;\n\n              case 27:\n                _context.prev = 27;\n                _context.t0 = _context[\"catch\"](3);\n                console.error(_context.t0);\n\n                _this.setState({\n                  error: 'An error occurred. Please try again.'\n                });\n\n              case 31:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[3, 27]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.handleLogout = function () {\n      _this.setState({\n        voterId: '',\n        password: '',\n        error: '',\n        loggedIn: false\n      });\n    };\n\n    _this.state = {\n      voterId: '',\n      password: '',\n      error: '',\n      loggedIn: false\n    };\n    return _this;\n  }\n\n  _createClass(LoginPage, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var loggedIn = localStorage.getItem('loggedIn') === 'true';\n      var voterId = localStorage.getItem('voterId');\n\n      if (loggedIn && voterId !== '') {\n        this.setState({\n          loggedIn: loggedIn\n        });\n        this.setState({\n          voterId: voterId\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state2 = this.state,\n          voterId = _this$state2.voterId,\n          password = _this$state2.password,\n          error = _this$state2.error;\n\n      if (this.state.loggedIn) {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 82,\n            columnNumber: 9\n          }\n        }, /*#__PURE__*/React.createElement(\"p\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 83,\n            columnNumber: 11\n          }\n        }, \"You are logged in as voter \", voterId), /*#__PURE__*/React.createElement(\"button\", {\n          onClick: this.handleLogout,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 84,\n            columnNumber: 11\n          }\n        }, \"Logout\"));\n      }\n\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"h2\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 9\n        }\n      }, \"Login Page\"), /*#__PURE__*/React.createElement(\"form\", {\n        onSubmit: this.handleSubmit,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 13\n        }\n      }, \"Voter ID:\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        name: \"voterId\",\n        value: voterId,\n        onChange: this.handleInputChange,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"label\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 13\n        }\n      }, \"Password:\"), /*#__PURE__*/React.createElement(\"input\", {\n        type: \"password\",\n        name: \"password\",\n        value: password,\n        onChange: this.handleInputChange,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"submit\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 13\n        }\n      }, \"Login\")), error && /*#__PURE__*/React.createElement(\"p\", {\n        className: \"error\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 21\n        }\n      }, error)));\n    }\n  }]);\n\n  return LoginPage;\n}(Component);\n\nexport default withRouter(LoginPage);","map":{"version":3,"sources":["C:/Users/danie/truffleProjects/ElectionSystem/src/components/LoginPage.js"],"names":["React","Component","withRouter","Web3","LoginPage","props","handleInputChange","event","target","name","value","setState","handleSubmit","preventDefault","voting","history","state","voterId","password","methods","isVoterEligible","call","voterEligible","getVoterDetails","voterInfo","web3","hashedPassword","utils","sha3","passwordHash","console","log","error","hasVoted","userHasVoted","loggedIn","localStorage","setItem","push","handleLogout","getItem"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { withRouter } from 'react-router';\r\nimport Web3 from 'web3';\r\n\r\nclass LoginPage extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      voterId: '',\r\n      password: '',\r\n      error: '',\r\n      loggedIn: false\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    const loggedIn = localStorage.getItem('loggedIn') === 'true';\r\n    const voterId = localStorage.getItem('voterId');\r\n    if (loggedIn && voterId!=='') {\r\n      this.setState({ loggedIn });\r\n      this.setState({voterId});\r\n    }\r\n  }\r\n  \r\n  handleInputChange = event => {\r\n    const { name, value } = event.target;\r\n    this.setState({ [name]: value });\r\n  };\r\n\r\n  handleSubmit = async event => {\r\n    event.preventDefault();\r\n    const { voting, history } = this.props;\r\n    const { voterId, password } = this.state;\r\n\r\n    try {\r\n      const voterEligible = await voting.methods.isVoterEligible(voterId).call();\r\n      if (voterEligible) {\r\n        const voterInfo = await voting.methods.getVoterDetails(voterId).call();\r\n        const web3 = new Web3()\r\n        const hashedPassword = web3.utils.sha3(password);\r\n        if (voterInfo.passwordHash !== hashedPassword) {\r\n          console.log('FROM CONTRACT:', voterInfo.passwordHash)\r\n          console.log('FROM sha3', hashedPassword)\r\n          this.setState({ error: 'Invalid password.' });\r\n          return;\r\n        }\r\n\r\n        const userHasVoted = await voting.methods.hasVoted(voterId).call();\r\n\r\n        if (userHasVoted) {\r\n          this.setState({ error: 'You have already voted.' });\r\n        } else {\r\n          this.setState({loggedIn: true})\r\n          localStorage.setItem('loggedIn', true);\r\n          localStorage.setItem('voterId', voterId);\r\n          history.push('/voting?voterId='+voterId);\r\n        }\r\n      } else {\r\n        this.setState({ error: 'You are not eligible to vote.' });\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n      this.setState({ error: 'An error occurred. Please try again.' });\r\n    }\r\n  };\r\n\r\n  handleLogout = () => {\r\n    this.setState({\r\n      voterId: '',\r\n      password: '',\r\n      error: '',\r\n      loggedIn: false,\r\n    });\r\n  };\r\n  \r\n\r\n  render() {\r\n    const { voterId, password, error } = this.state;\r\n\r\n    if (this.state.loggedIn) {\r\n      return (\r\n        <div>\r\n          <p>You are logged in as voter {voterId}</p>\r\n          <button onClick={this.handleLogout}>Logout</button>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div>\r\n        <h2>Login Page</h2>\r\n        <form onSubmit={this.handleSubmit}>\r\n          <div>\r\n            <label>Voter ID:</label>\r\n            <input\r\n              type=\"text\"\r\n              name=\"voterId\"\r\n              value={voterId}\r\n              onChange={this.handleInputChange}\r\n            />\r\n          </div>\r\n          <div>\r\n            <label>Password:</label>\r\n            <input\r\n              type=\"password\"\r\n              name=\"password\"\r\n              value={password}\r\n              onChange={this.handleInputChange}\r\n            />\r\n          </div>\r\n          <div>\r\n            <button type=\"submit\">Login</button>\r\n          </div>\r\n          {error && <p className=\"error\">{error}</p>}\r\n        </form>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(LoginPage);\r\n"]},"metadata":{},"sourceType":"module"}